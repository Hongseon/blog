---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
	const posts = await getCollection('blog');
	const categories = new Set<string>();
	posts.forEach((post) => {
		categories.add(post.data.category);
	});

	return Array.from(categories).map((category) => ({
		params: { category },
		props: { category },
	}));
}

const { category } = Astro.props;
const allPosts = await getCollection('blog');
const filteredPosts = allPosts
	.filter((post) => post.data.category === category)
	.sort((a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime());
---

<BaseLayout title={`카테고리: ${category} - My Blog`} description={`${category} 카테고리의 포스트 목록입니다.`}>
	<div class="space-y-8">
		<div class="text-center mb-12">
			<h1 class="text-4xl font-bold mb-4 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">
				카테고리: {category}
			</h1>
			<p class="text-slate-600 dark:text-slate-400">
				총 {filteredPosts.length}개의 포스트
			</p>
		</div>

		<div class="space-y-6">
			{filteredPosts.map((post) => (
				<article class="bg-white dark:bg-slate-800 rounded-lg shadow-md p-6 border border-slate-200 dark:border-slate-700 hover:shadow-xl transition-all duration-300">
					<a href={`/blog/${post.slug}`} class="block">
						<div class="flex items-center gap-3 mb-3">
							<span class="text-xs px-2 py-1 bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300 rounded-full">
								{post.data.category}
							</span>
							<time class="text-sm text-slate-500 dark:text-slate-400">
								{post.data.pubDate.toLocaleDateString('ko-KR')}
							</time>
						</div>
						<h2 class="text-2xl font-semibold mb-2 text-slate-800 dark:text-slate-200 hover:text-blue-600 dark:hover:text-blue-400 transition-colors">
							{post.data.title}
						</h2>
						{post.data.description && (
							<p class="text-slate-600 dark:text-slate-400 mb-3 line-clamp-2">
								{post.data.description}
							</p>
						)}
						{post.data.tags.length > 0 && (
							<div class="flex flex-wrap gap-2">
								{post.data.tags.map((tag) => (
									<span class="text-xs px-2 py-1 bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300 rounded">
										#{tag}
									</span>
								))}
							</div>
						)}
					</a>
				</article>
			))}
		</div>

		<div class="mt-8 text-center">
			<a 
				href="/blog"
				class="inline-block px-6 py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-lg hover:from-blue-700 hover:to-purple-700 transition-all shadow-md hover:shadow-lg"
			>
				← 목록으로 돌아가기
			</a>
		</div>
	</div>
</BaseLayout>

